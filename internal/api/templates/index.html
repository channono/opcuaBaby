<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Monitor</title>
    <style>
        /* ★ html 和 body 占满高度，并使用 flex 布局 */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
        }

        /* ★ 主体内容区域，自动占据剩余空间，把 footer 顶到最底 */
        main {
            flex: 1;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 960px;
            margin: 20px auto;
            padding: 0 20px;
        }

        h1 { color: #2c3e50; }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th { background-color: #f2f2f2; }

        a { color: #2980b9; text-decoration: none; }
        a:hover { text-decoration: underline; }

        /* ★ footer 固定在 flex 布局末尾 */
        footer {
            flex-shrink: 0;
            background-color: #f4f4f4;
            padding: 10px 20px;
            text-align: center;
        }
    </style>


</head>
<body>

    <main>
        <h1>Connected WebSocket Clients</h1>
        <p>The following clients are currently connected to the WebSocket server.</p>
        <p>查看 <a href="/doc" target="_blank">API 文档</a> 获取更多信息。</p>
        <table id="clients-table">
            <thead>
                <tr>
                    <th>Remote Address</th>
                    <th>Subscriptions</th>
                </tr>
            </thead>
            <tbody>
                <!-- 数据 -->
            </tbody>
        </table>
    </main>
    <hr>
    <footer>
        &copy; 2025 Big GiantBaby 大牛大巨婴. 本App采用 <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer">CC BY-SA 4.0</a> 协议许可。  
        您可以在保留署名的前提下自由分享与修改。
    </footer>
    <script>
        function fetchClientData() {
            fetch('/api/v1/ws/clients')
                .then(response => response.json())
                .then(data => {
                    const tableBody = document.getElementById('clients-table').getElementsByTagName('tbody')[0];
                    tableBody.innerHTML = ''; // Clear existing rows
                    if (data) {
                        data.forEach(client => {
                            let row = tableBody.insertRow();
                            let cell1 = row.insertCell();
                            let cell2 = row.insertCell();
                            cell1.textContent = client.remote_addr;
                            cell2.textContent = client.subscriptions.join(', ');
                        });
                    }
                })
                .catch(error => console.error('Error fetching client data:', error));
        }

        // Fetch data every 5 seconds
        setInterval(fetchClientData, 5000);
        // Initial fetch
        fetchClientData();
    </script>

</body>
</html>
